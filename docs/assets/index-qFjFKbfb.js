var b=Object.defineProperty;var T=(e,t,a)=>t in e?b(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var L=(e,t,a)=>(T(e,typeof t!="symbol"?t+"":t,a),a);import{signal as q,render as A,html as S}from"https://cdn.jsdelivr.net/npm/uhtml/preactive.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const n of s.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function a(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=a(r);fetch(r.href,s)}})();const C={},E=1e3*60*60,f=q({isLoading:!1,data:void 0,error:void 0}),w=({tags:e,ttl:t=E,query:a,baseUrl:i,fetchFn:r})=>(s,n)=>(navigator.serviceWorker.ready.then(o=>{var m;const l=d=>{d.data.type==="CACHE_ENTRY_INVALIDATED"&&y()},c=()=>{navigator.serviceWorker.removeEventListener("message",l)};c(),s.push(c),navigator.serviceWorker.startMessages(),navigator.serviceWorker.addEventListener("message",l);const u=a(n),p=`${i}${u.url}`,h=structuredClone(u);delete h.url;const v={url:p,method:u.method||"GET",ttl:t,body:u.body?JSON.stringify(u.body):null};e.forEach(d=>{C[d]=v}),(m=o.active)==null||m.postMessage({type:"TTL",req:v});const y=()=>{const d=new Request(p,h);f.value={...f.value,isLoading:!0},r(d).then(g=>g.json()).then(g=>{f.value={data:g,isLoading:!1}}).catch(g=>{f.value={error:g,isLoading:!1}})};y()}),f),F=({baseQuery:e,endpoints:t})=>{const{baseUrl:a,fetchFn:i}=e;return navigator.serviceWorker.ready.then(n=>{var o;(o=n.active)==null||o.postMessage({type:"HANDLE_URL",url:a})}),Object.entries(t({query:({query:n,providesTags:o,ttl:l})=>c=>({name:`create${c}QuerySignal`,signalCreator:w({tags:o,ttl:l,query:n,baseUrl:a,fetchFn:i})})})).reduce((n,[o,l])=>{const c=l(o);return n[c.name]=c.signalCreator,n},{})},N=({baseUrl:e})=>({baseUrl:e,fetchFn:window.fetch}),k=F({baseQuery:N({baseUrl:"https://catfact.ninja"}),endpoints:e=>({GetCatFact:e.query({query:()=>({url:"/fact"}),providesTags:["cat"],ttl:E})})}),{createGetCatFactQuerySignal:O}=k,W=e=>{navigator.serviceWorker.ready.then(t=>{var a;(a=t.active)==null||a.postMessage({type:"INVALIDATE_CACHE_ENTRY",req:C[e]})})};customElements.define("cat-fact",class extends HTMLElement{constructor(){super();L(this,"render",()=>{var t;return S`
      <div>
        <h1>Cat fact of the day</h1>
        <p>${this.catFact.value.isLoading?"loading...":(t=this.catFact.value.data)==null?void 0:t.fact}</p>
        <button onclick=${()=>{W("cat")}}>change cat fact</button>
      </div>
  `});this.cleanups=[]}connectedCallback(){this.catFact=O(this.cleanups),A(this,this.render)}disconnectedCallback(){this.cleanups.forEach(t=>t())}});const D=async()=>{try{const e=await navigator.serviceWorker.register("sw.js",{scope:"./"});e.update(),console.log("Service worker registration succeeded:",e)}catch(e){console.error(`Service worker registration failed: ${e}`)}};D();navigator.serviceWorker.controller||location.reload();
